name: Create and Deploy Docusaurus

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Create Docusaurus Project
        run: |
          # Create a new Docusaurus project
          npx create-docusaurus@latest . classic --skip-install
          
          # Customize Docusaurus configuration
          sed -i "s|title: 'Docusaurus'|title: 'Bubble Documentation'|g" docusaurus.config.js
          sed -i "s|tagline: 'Dinosaurs are cool'|tagline: 'Your awesome documentation'|g" docusaurus.config.js
          sed -i "s|url: 'https://your-docusaurus-site.example.com'|url: 'https://${{ github.repository_owner }}.github.io'|g" docusaurus.config.js
          sed -i "s|baseUrl: '/'|baseUrl: '/bubble-documentation/'|g" docusaurus.config.js
          sed -i "s|organizationName: 'facebook'|organizationName: '${{ github.repository_owner }}'|g" docusaurus.config.js
          sed -i "s|projectName: 'docusaurus'|projectName: 'bubble-documentation'|g" docusaurus.config.js
          sed -i "s|trailingSlash: false|trailingSlash: false|g" docusaurus.config.js
          sed -i "s|deploymentBranch: 'gh-pages'|deploymentBranch: 'gh-pages'|g" docusaurus.config.js

      - name: Install Dependencies
        run: npm install

      - name: Build
        run: npm run build

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./build
